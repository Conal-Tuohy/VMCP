<!-- 
	This file contains field definitions for the search and browse functions of the site.
	
	The definition controls three aspects of the fields:
	1	the field types in the Solr schema (how Solr should interpret the content)
	2	the field content (how the fields are populated from the TEI XML)
	3	the field display (how they are queried and displayed)
	
	The @name attribute defines the name of the field in Solr and in the HTTP query URIs. Use lower case, single token with no spaces.
	
	The @label attribute provides the field's label in the UI. Fields with no @label will not appear in the UI at all.
	
	The @xpath attribute defines the content of the field. 
	An XPath which returns a sequence of more than one item will produce a multi-valued field.
	The TEI namespace is the default. 
	The XPath version supported is 3.1.
-->

<fields>
	<field name="id" xpath="/TEI/@xml:id"/>
	<field name="title"
		label="Title"
		xpath="
			(
				/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msContents/msItem/title[@type='main'],
				/TEI/teiHeader/fileDesc/titleStmt/title
			)[1]
		"
	/>
	<field name="description" label="Description"
		xpath="/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msContents/msItem/note[@type='description']"
	/>
	<field name="institution" label="Institution" xpath="/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msIdentifier/institution" type="facet"/>
	<field name="repository" label="Repository" xpath="/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msIdentifier/repository" type="facet"/>
	<field 
		name="symbol" 
		label="Symbol" 
		xpath="
			for $character 
			in /TEI/teiHeader/encodingDesc/charDecl/char[charProp[localName='type']/value='symbol']
			return concat($character/mapping, ' ', $character/charName)
		"
		type="facet"/>
	<field
		name="person"
		label="People"
		xpath="for $person-name in //persName return string-join($person-name//text()[not(ancestor::orig)][not(ancestor::abbrev)])"
		type="facet"/>
	<field
		name="sort"
		xpath="
			string-join(
				(
					/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msIdentifier/settlement,
					/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msIdentifier[country/@key='US']/region/@key,
					/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msIdentifier/altIdentifier/idno[@type='collection'],
					/TEI/teiHeader/fileDesc/sourceDesc/msDesc/msIdentifier/idno
				),
				' '
			)
		"
		type="sort"/>
</fields>